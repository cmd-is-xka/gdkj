name: RDaily Task

on:
  schedule:
    - cron: '0 0,6 * * *'  # æ¯ 5 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  # ä½¿ç”¨ç¨³å®šç‰ˆæœ¬

      # - name: ðŸ“¥ Install Allure CLI
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y default-jre wget unzip
      #     wget https://github.com/allure-framework/allure2/releases/download/2.27.0/allure-2.27.0.zip
      #     unzip allure-2.27.0.zip
      #     sudo mv allure-2.27.0 /opt/allure
      #     sudo ln -s /opt/allure/bin/allure /usr/bin/allure
      #     allure --version
      - name: ðŸ“¥ Check & Install Allure CLI (only if not installed)
        run: |
          if ! command -v allure &> /dev/null
          then
            echo "Allure æœªå®‰è£…ï¼Œå¼€å§‹å®‰è£…..."
            sudo apt-get update
            sudo apt-get install -y default-jre wget unzip
            wget https://github.com/allure-framework/allure2/releases/download/2.27.0/allure-2.27.0.zip
            unzip allure-2.27.0.zip
            sudo mv allure-2.27.0 /opt/allure
            sudo ln -s /opt/allure/bin/allure /usr/bin/allure
          else
            echo "âœ… Allure å·²å®‰è£…ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤"
          fi
      - name: âœ… æŸ¥çœ‹ Allure ç‰ˆæœ¬ç¡®è®¤å®‰è£…
        run: |
          allure --version


      - name: Install dependencies
        run: |
          pip install -r installpackage.txt

      - name: Run API test
        run: |
          python ./Gdkjmain/main.py

      - name: Notify result
        run: |
          python notify.py

      - name: ðŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./allure-report